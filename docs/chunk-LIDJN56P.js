import{B as s,Ba as ne,C as k,Ca as re,D as y,Da as S,E as m,Ea as oe,F as h,Fa as j,Ga as P,I as o,Ia as ae,J as a,Ja as se,K as f,Ka as le,L as I,M as B,N as x,O as g,P as u,R as c,S as F,T as C,U as b,V as v,W as w,X,Y as O,_ as T,a as N,ca as G,da as U,ea as q,ha as z,i as Y,ia as J,j as _,k as L,m as E,oa as K,p as R,q as D,qa as Q,ra as Z,sa as $,t as p,ta as ee,u as d,ua as te,va as ie}from"./chunk-5RAA33PE.js";import{a as A,b as W}from"./chunk-ALVAB2FF.js";var pe=l=>({"history-expand-filter-button-active":l});function de(l,t){if(l&1){let e=x();I(0),o(1,"div",26)(2,"input",27),g("change",function(){p(e);let n=u(2);return d(n.applyFilters())}),w("ngModelChange",function(n){let r=p(e).$implicit,M=u(2);return v(M.filterCategories[r.id],n)||(M.filterCategories[r.id]=n),d(n)}),a(),o(3,"label",28),c(4),a()(),B()}if(l&2){let e=t.$implicit,i=u(2);s(2),m("value",e.id)("id",e.id)("checked",i.filterCategories[e.id]),b("ngModel",i.filterCategories[e.id]),s(),m("for",e.id),s(),F(e.name)}}function me(l,t){if(l&1){let e=x();I(0),o(1,"div",26)(2,"input",27),g("change",function(){p(e);let n=u(2);return d(n.applyFilters())}),w("ngModelChange",function(n){let r=p(e).$implicit,M=u(2);return v(M.filterCategories[r.id],n)||(M.filterCategories[r.id]=n),d(n)}),a(),o(3,"label",28),c(4),a()(),B()}if(l&2){let e=t.$implicit,i=u(2);s(2),m("value",e.id)("id",e.id)("checked",i.filterCategories[e.id]),b("ngModel",i.filterCategories[e.id]),s(),m("for",e.id),s(),F(e.name)}}function ge(l,t){if(l&1){let e=x();o(0,"div",8)(1,"div",9)(2,"div",10)(3,"span"),c(4,"\u041F\u0435\u0440\u0438\u043E\u0434:"),a(),o(5,"select",11),g("change",function(){p(e);let n=u();return d(n.applyFilters())}),w("ngModelChange",function(n){p(e);let r=u();return v(r.filterDate,n)||(r.filterDate=n),d(n)}),o(6,"option",12),c(7,"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0432\u0441\u0435"),a(),o(8,"option",13),c(9,"\u0421\u0435\u0433\u043E\u0434\u043D\u044F"),a(),o(10,"option",14),c(11,"\u042D\u0442\u0430 \u043D\u0435\u0434\u0435\u043B\u044F"),a(),o(12,"option",15),c(13,"\u042D\u0442\u043E\u0442 \u043C\u0435\u0441\u044F\u0446"),a()()(),o(14,"div",16)(15,"span"),c(16,"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F:"),a(),f(17,"br"),o(18,"button",17),g("click",function(){p(e);let n=u();return d(n.clearFilters())}),c(19,"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u0432\u0441\u0435 \u0444\u0438\u043B\u044C\u0442\u0440\u044B"),a(),f(20,"br"),o(21,"div",18)(22,"input",19),g("change",function(){p(e);let n=u();return d(n.filterMass("regular"))}),w("ngModelChange",function(n){p(e);let r=u();return v(r.filterCategories.regular,n)||(r.filterCategories.regular=n),d(n)}),a(),o(23,"label",20),c(24,"\u0420\u0435\u0433\u0443\u043B\u044F\u0440\u043D\u043E\u0435"),a()(),o(25,"div",21),y(26,de,5,6,"ng-container",7),a(),o(27,"div",18)(28,"input",22),g("change",function(){p(e);let n=u();return d(n.filterMass("irregular"))}),w("ngModelChange",function(n){p(e);let r=u();return v(r.filterCategories.irregular,n)||(r.filterCategories.irregular=n),d(n)}),a(),o(29,"label",23),c(30,"\u041D\u0435\u0440\u0435\u0433\u0443\u043B\u044F\u0440\u043D\u043E\u0435"),a()(),o(31,"div",21),y(32,me,5,6,"ng-container",7),a()()(),o(33,"div",24)(34,"button",25),g("click",function(){p(e);let n=u();return d(n.applyFiltersAndClose())}),c(35,"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C"),a()()()}if(l&2){let e=u();s(5),b("ngModel",e.filterDate),s(17),m("checked",e.filterCategories.regular),b("ngModel",e.filterCategories.regular),s(4),m("ngForOf",e.categories.regular),s(2),m("checked",e.filterCategories.irregular),b("ngModel",e.filterCategories.irregular),s(4),m("ngForOf",e.categories.irregular)}}function he(l,t){l&1&&(o(0,"div",29)(1,"span"),c(2,"\u0414\u043B\u044F \u044D\u0442\u0438\u0445 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0439 \u0438 \u043F\u0435\u0440\u0438\u043E\u0434\u0430 \u0442\u0440\u0430\u0442 \u043D\u0435\u0442"),a()())}function fe(l,t){if(l&1&&(o(0,"span")(1,"span"),c(2),O(3,"date"),a(),o(4,"span"),c(5),a()()),l&2){let e=u().$implicit,i=u();h("background","#f8d7da")("width","100%")("display","block"),s(2),C("",T(3,10,e.date,"dd-MM-YYYY")," - "),s(2),h("font-weight","600"),s(),C("",i.getTotalAmountPerDay(e.date),"\u20AC")}}function ye(l,t){if(l&1){let e=x();o(0,"span",25),g("click",function(){p(e);let n=u().index,r=u();return d(r.onDeleteFromBalance(n))}),c(1," | Delete from balance"),a()}l&2&&h("color","grey")("cursor","pointer")}function _e(l,t){if(l&1){let e=x();o(0,"span"),y(1,fe,6,13,"span",30),o(2,"div",31),f(3,"br"),c(4,"\u0426\u0435\u043D\u0430: "),o(5,"span"),c(6),a(),f(7,"br")(8,"br"),o(9,"div"),c(10," Category: "),o(11,"span",32),g("click",function(){let n=p(e).$implicit,r=u();return d(r.showCategoryDetails(n.category))}),c(12),a()(),c(13),O(14,"date"),f(15,"br")(16,"br"),o(17,"span",25),g("click",function(){let n=p(e).index,r=u();return d(r.onDelete(n))}),c(18,"Delete"),a(),y(19,ye,2,4,"span",33),a(),f(20,"hr"),a()}if(l&2){let e=t.$implicit,i=u();s(),m("ngIf",e.showDateTitle),s(4),h("color","#ff6f61"),s(),C("",e.amount,"\u20AC"),s(6),F(i.getCategoryNameByIdFunc(e.category)),s(),C(" Date: ",T(14,15,e.date,"HH:mm")," "),s(4),h("color","grey")("cursor","pointer"),s(2),m("ngIf",!e.isDeletedFromBalance&&i.getCategoryByIdFunc(e.category).includeInBalance),s(),h("background","#f8d7da")("height","2px")}}var V=class l{constructor(t,e,i){this.router=t;this.expenseService=e;this.balanceService=i}expenses=[];totalAmount=0;temporaryDate=0;totalAmountPerDays=new Map;getCategoryByIdFunc=j;filterDate="";categories={regular:P.filter(t=>!t.includeInBalance),irregular:P.filter(t=>t.includeInBalance)};filterCategories=P.reduce((t,e)=>(t[e.id]=!1,t),{});expandFilters=!1;getCategoryNameByIdFunc=oe;destroySubject=new N;ngOnInit(){this.initiateExpenses().pipe(_(this.destroySubject)).subscribe(()=>{this.sumValues(),this.filterCategories.irregular=!1,this.filterCategories.regular=!1})}initiateExpenses(){return this.expenseService.getExpenses().pipe(L(t=>{this.expenses=t.map(e=>{let i=this.isDatePanelVisible(e.date);if(i)this.totalAmountPerDays.set(e.date,e.amount);else{let n=this.totalAmountPerDays.get(this.temporaryDate)||0,r=Math.round((n+e.amount)*100)/100;this.totalAmountPerDays.set(this.temporaryDate,r)}return W(A({},e),{showDateTitle:i})})}))}applyFilters(){this.initiateExpenses().pipe(_(this.destroySubject)).subscribe(()=>{if(this.checkMainCategory(),this.filterDate===""&&Object.values(this.filterCategories).every(e=>!e)){this.sumValues();return}if(this.expenses=this.expenses.filter(e=>Object.values(this.filterCategories).every(i=>!i)||Object.keys(this.filterCategories).some(i=>this.filterCategories[i]&&e.category===i)),this.filterDate===""){this.sumValues();return}let t=new Date;if(this.filterDate==="thisWeek"){let e=t.getDay(),i=e===0?6:e-1;t.setDate(t.getDate()-i)}this.filterDate==="thisMonth"&&(t=new Date(t.setDate(1))),this.expenses=this.expenses.filter(e=>{let i=new Date(e.date);return i.getDate()>=t.getDate()&&i.getMonth()===t.getMonth()&&i.getFullYear()===t.getFullYear()}),this.sumValues()})}applyFiltersAndClose(){this.applyFilters(),this.expandFilters=!1}checkMainCategory(){let t=this.categories.regular.map(r=>r.id),e=this.categories.irregular.map(r=>r.id),i=t.every(r=>this.filterCategories[r]),n=e.every(r=>this.filterCategories[r]);return this.filterCategories.regular=i,this.filterCategories.irregular=n,{regularChecked:i,irregularChecked:n}}filterMass(t){let e=t==="regular"?this.categories.regular:this.categories.irregular;e=e.map(i=>i.id),this.filterCategories[t]&&e.forEach(i=>{this.filterCategories[i]=!1});for(let i in this.filterCategories)e.includes(i)&&(this.filterCategories[i]=!this.filterCategories[i]);this.applyFilters()}initiateFilterCategory(){for(let t in this.filterCategories)this.filterCategories[t]=!1}clearFilters(){this.initiateFilterCategory(),this.filterDate="",this.applyFilters()}toggleExpandFilters(){this.applyFilters(),this.expandFilters=!this.expandFilters}getTotalAmountPerDay(t){return this.totalAmountPerDays.get(t)||0}onDelete(t){if(confirm("Delete?")){this.updateBalance(t);let e=this.expenses[t].id;this.expenseService.deleteExpense(e).pipe(Y(()=>this.initiateExpenses()),_(this.destroySubject)).subscribe(()=>this.sumValues())}}updateBalance(t,e){let i=Number(localStorage.getItem("balance"))||0,n=j(this.expenses[t].category);if(i&&!this.expenses[t]?.isDeletedFromBalance&&n?.includeInBalance){let r=Math.round((i+this.expenses[t].amount)*100)/100;this.balanceService.addBalance(r).pipe(_(this.destroySubject)).subscribe()}e&&(this.expenses[t].isDeletedFromBalance=e,this.expenseService.updateExpense(this.expenses[t]).pipe(_(this.destroySubject)).subscribe())}onDeleteFromBalance(t){confirm("Return to balance?")&&this.updateBalance(t,!0)}onSwipeRight(){this.router.navigate(["/"])}showCategoryDetails(t){this.router.navigate(["/details"],{queryParams:{"category-id":t,"back-url":"/history"}})}isDatePanelVisible(t){return this.temporaryDate===0?(this.temporaryDate=t,!0):new Date(this.temporaryDate).toDateString()===new Date(t).toDateString()?!1:(this.temporaryDate=t,!0)}touchStartX=0;touchStartY=0;touchEndX=0;touchEndY=0;onTouchStart(t){this.touchStartX=t.changedTouches[0].screenX,this.touchStartY=t.changedTouches[0].screenY}onTouchEnd(t){this.touchEndX=t.changedTouches[0].screenX,this.touchEndY=t.changedTouches[0].screenY,this.handleSwipeGesture()}handleSwipeGesture(){let t=this.touchEndX-this.touchStartX,e=this.touchEndY-this.touchStartY;Math.abs(t)>Math.abs(e)&&(t>50?this.onSwipeRight():t<-50&&this.onSwipeLeft())}onSwipeLeft(){this.router.navigate(["/statistics"])}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}sumValues(){this.totalAmount=this.expenses.reduce((t,e)=>{let i=t+e.amount;return Math.round(i*100)/100},0)}static \u0275fac=function(e){return new(e||l)(k(ne),k(ae),k(se))};static \u0275cmp=R({type:l,selectors:[["app-history"]],hostBindings:function(e,i){e&1&&g("touchstart",function(r){return i.onTouchStart(r)})("touchend",function(r){return i.onTouchEnd(r)})},decls:16,vars:20,consts:[[1,"history-container"],[3,"routerLink"],[1,"history-container-top"],[1,"history-expand-filter-button",3,"click","ngClass"],[1,"fas","fa-filter"],["class","history-expand-filter-container",4,"ngIf"],["class","history-empty",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"history-expand-filter-container"],[1,"history-expand-filter"],[1,"history-expand-filter-date"],[3,"change","ngModelChange","ngModel"],["value",""],["value","today"],["value","thisWeek"],["value","thisMonth"],[1,"history-expand-filter-category"],[1,"history-button-clear-filters",3,"click"],[1,"category-checkbox","category-checkbox-main"],["type","checkbox","value","regular","id","category-regular",3,"change","ngModelChange","checked","ngModel"],["for","category-regular"],[1,"sub-category-items"],["type","checkbox","value","irregular","id","category-irregular",3,"change","ngModelChange","checked","ngModel"],["for","category-irregular"],[1,"history-expand-filter-buttons"],[3,"click"],[1,"category-checkbox","category-checkbox-sub"],["type","checkbox",3,"change","ngModelChange","value","id","checked","ngModel"],[3,"for"],[1,"history-empty"],[3,"background","width","display",4,"ngIf"],[1,"history-item"],[1,"app-link",3,"click"],[3,"color","cursor","click",4,"ngIf"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"span",1),c(2,"< Back"),a(),f(3,"br"),o(4,"div",2)(5,"div")(6,"span"),c(7,"\u041E\u0431\u0449\u0438\u0439 \u0440\u0430\u0441\u0445\u043E\u0434: "),a(),o(8,"span"),c(9),a()(),o(10,"button",3),g("click",function(){return i.toggleExpandFilters()}),f(11,"i",4),a()(),y(12,ge,36,7,"div",5),f(13,"hr"),y(14,he,3,0,"div",6)(15,_e,21,18,"span",7),a()),e&2&&(s(),h("color","blue")("cursor","pointer"),m("routerLink","/"),s(4),h("margin","10","px"),s(3),h("color","#ff6f61"),s(),C("",i.totalAmount,"\u20AC"),s(),m("ngClass",X(18,pe,i.expandFilters)),s(2),m("ngIf",i.expandFilters),s(),h("background","#f8d7da")("height","2px"),s(),m("ngIf",!i.expenses.length),s(),m("ngForOf",i.expenses))},dependencies:[re,G,U,q,ee,te,K,$,Q,Z,z],styles:[".history-container[_ngcontent-%COMP%]{height:100dvh;overflow-y:scroll}.history-container[_ngcontent-%COMP%]   .history-item[_ngcontent-%COMP%]{padding-left:10px}.history-container-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 1rem 0 0}.history-expand-filter-button[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:#000;border:2px solid #f8d7da;background-color:transparent;border-radius:5px;padding:.5rem 1rem;margin:.5rem;cursor:pointer}.history-expand-filter-button-active[_ngcontent-%COMP%]{background-color:#f8d7da}.history-expand-filter-container[_ngcontent-%COMP%]{display:flex;align-items:flex-start;flex-direction:column;margin:.5rem}.history-button-clear-filters[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:gray;border:none;background-color:transparent;cursor:pointer;margin:.5rem 0 0;padding:0;text-decoration:underline}.history-expand-filter-buttons[_ngcontent-%COMP%]{display:flex;margin:1rem 0;width:100%;justify-content:center}.history-expand-filter-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:#000;border:2px solid #f8d7da;background-color:#f8d7da;border-radius:5px;padding:.5rem 1rem;cursor:pointer;width:100%}.history-expand-filter[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;width:100%}.history-expand-filter[_ngcontent-%COMP%]   .history-expand-filter-date[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;font-family:Montserrat,sans-serif;padding:.5rem;border:2px solid #f8d7da;border-radius:5px;cursor:pointer}.category-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row;gap:.5rem;margin-top:.5rem}.category-checkbox[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100%}.category-checkbox-main[_ngcontent-%COMP%]{display:flex;font-family:Montserrat,sans-serif;color:#000;flex-direction:row;gap:.5rem}.category-checkbox-sub[_ngcontent-%COMP%]{margin-left:2rem}.history-empty[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-family:Montserrat,sans-serif;color:#000}"]})};var xe=[{path:"",component:V}],H=class l{static \u0275fac=function(e){return new(e||l)};static \u0275mod=D({type:l});static \u0275inj=E({imports:[S.forChild(xe),S]})};var ue=class l{static \u0275fac=function(e){return new(e||l)};static \u0275mod=D({type:l});static \u0275inj=E({imports:[S,H,J,ie,le]})};export{ue as HistoryModule};
