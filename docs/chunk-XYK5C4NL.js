import{C,D as h,E as c,H as r,I as a,J as p,K as S,L as y,M as u,O as s,P as M,Q as d,W as w,X as I,a as E,b as P,fa as T,ga as k,ha as F,ia as N,l as g,n as H,o as x,qa as A,r as _,ra as V,s as b,sa as f,ta as Y,ua as O,x as i,y as B}from"./chunk-5Q33YVPF.js";function L(o,e){if(o&1&&(r(0,"span")(1,"span"),s(2),w(3,"date"),a(),r(4,"span"),s(5),a()()),o&2){let t=u().$implicit,n=u();c("background","#f8d7da")("width","100%")("display","block"),i(2),d("",I(3,10,t.date,"dd-MM-YYYY")," - "),i(2),c("font-weight","600"),i(),d("",n.getTotalAmountPerDay(t.date),"\u20AC")}}function j(o,e){if(o&1){let t=S();r(0,"span",5),y("click",function(){_(t);let l=u().index,m=u();return b(m.onDeleteFromBalance(l))}),s(1," | Delete from balance"),a()}o&2&&c("color","grey")("cursor","pointer")}function J(o,e){if(o&1){let t=S();r(0,"span"),C(1,L,6,13,"span",3),r(2,"div",4),p(3,"br"),s(4,"\u0426\u0435\u043D\u0430: "),r(5,"span"),s(6),a(),p(7,"br")(8,"br"),r(9,"div"),s(10," Category: "),r(11,"span",5),y("click",function(){let l=_(t).$implicit,m=u();return b(m.showCategoryDetails(l.category))}),s(12),a()(),s(13),w(14,"date"),p(15,"br")(16,"br"),r(17,"span",5),y("click",function(){let l=_(t).index,m=u();return b(m.onDelete(l))}),s(18,"Delete"),a(),C(19,j,2,4,"span",6),a(),p(20,"hr"),a()}if(o&2){let t=e.$implicit,n=u();i(),h("ngIf",t.showDateTitle),i(4),c("color","#ff6f61"),i(),d("",t.amount,"\u20AC"),i(5),c("color","blue"),i(),M(n.getCategoryNameByIdFunc(t.category)),i(),d(" Date: ",I(14,17,t.date,"HH:mm")," "),i(4),c("color","grey")("cursor","pointer"),i(2),h("ngIf",!t.isDeletedFromBalance&&n.getCategoryByIdFunc(t.category).includeInBalance),i(),c("background","#f8d7da")("height","2px")}}var D=class o{constructor(e){this.router=e}expenses=[];totalAmount=0;temporaryDate=0;totalAmountPerDays=new Map;getCategoryByIdFunc=O;getCategoryNameByIdFunc=Y;ngOnInit(){this.expenses=JSON.parse(localStorage.getItem("expenses")||"[]").map(e=>{let t=this.isDatePanelVisible(e.date);if(t)this.totalAmountPerDays.set(e.date,e.amount);else{let n=this.totalAmountPerDays.get(this.temporaryDate)||0,l=Math.round((n+e.amount)*100)/100;this.totalAmountPerDays.set(this.temporaryDate,l)}return P(E({},e),{showDateTitle:t})}),this.sumValues()}getTotalAmountPerDay(e){return this.totalAmountPerDays.get(e)||0}onDelete(e){confirm("Delete?")&&(this.updateBalance(e),this.expenses.splice(e,1),localStorage.setItem("expenses",JSON.stringify(this.expenses)),this.sumValues())}updateBalance(e,t){let n=Number(localStorage.getItem("balance"))||0;if(n&&!this.expenses[e]?.isDeletedFromBalance){let l=Math.round((n+this.expenses[e].amount)*100)/100;t&&(this.expenses[e].isDeletedFromBalance=t,localStorage.setItem("expenses",JSON.stringify(this.expenses))),localStorage.setItem("balance",l.toString())}}onDeleteFromBalance(e){confirm("Return to balance?")&&this.updateBalance(e,!0)}onSwipeRight(){this.router.navigate(["/"])}showCategoryDetails(e){this.router.navigate(["/details"],{queryParams:{"category-id":e,"back-url":"/history"}})}isDatePanelVisible(e){return this.temporaryDate===0?(this.temporaryDate=e,!0):new Date(this.temporaryDate).toDateString()===new Date(e).toDateString()?!1:(this.temporaryDate=e,!0)}touchStartX=0;touchStartY=0;touchEndX=0;touchEndY=0;onTouchStart(e){this.touchStartX=e.changedTouches[0].screenX,this.touchStartY=e.changedTouches[0].screenY}onTouchEnd(e){this.touchEndX=e.changedTouches[0].screenX,this.touchEndY=e.changedTouches[0].screenY,this.handleSwipeGesture()}handleSwipeGesture(){let e=this.touchEndX-this.touchStartX,t=this.touchEndY-this.touchStartY;Math.abs(e)>Math.abs(t)&&(e>50?this.onSwipeRight():e<-50&&this.onSwipeLeft())}onSwipeLeft(){this.router.navigate(["/statistics"])}sumValues(){this.totalAmount=this.expenses.reduce((e,t)=>{let n=e+t.amount;return Math.round(n*100)/100},0)}static \u0275fac=function(t){return new(t||o)(B(A))};static \u0275cmp=H({type:o,selectors:[["app-history"]],hostBindings:function(t,n){t&1&&y("touchstart",function(m){return n.onTouchStart(m)})("touchend",function(m){return n.onTouchEnd(m)})},decls:11,vars:15,consts:[[1,"history-container"],[3,"routerLink"],[4,"ngFor","ngForOf"],[3,"background","width","display",4,"ngIf"],[1,"history-item"],[3,"click"],[3,"color","cursor","click",4,"ngIf"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"span",1),s(2,"< Back"),a(),p(3,"br"),r(4,"div")(5,"span"),s(6,"\u041E\u0431\u0449\u0438\u0439 \u0440\u0430\u0441\u0445\u043E\u0434: "),a(),r(7,"span"),s(8),a()(),p(9,"hr"),C(10,J,21,20,"span",2),a()),t&2&&(i(),c("color","blue")("cursor","pointer"),h("routerLink","/"),i(3),c("margin","10","px"),i(3),c("color","#ff6f61"),i(),d("",n.totalAmount,"\u20AC"),i(),c("background","#f8d7da")("height","2px"),i(),h("ngForOf",n.expenses))},dependencies:[V,T,k,F],styles:[".history-container[_ngcontent-%COMP%]{height:100dvh;overflow-y:scroll}.history-container[_ngcontent-%COMP%]   .history-item[_ngcontent-%COMP%]{padding-left:10px}"]})};var $=[{path:"",component:D}],v=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=x({type:o});static \u0275inj=g({imports:[f.forChild($),f]})};var X=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=x({type:o});static \u0275inj=g({imports:[f,v,N]})};export{X as HistoryModule};
