import{B as w,C as _,D as a,G as s,H as c,I as m,J as T,K as h,L as p,N as r,O as M,P as d,V as E,W as H,a as S,b as C,da as k,ea as B,fa as N,ga as A,k as f,m as I,n as g,oa as Y,pa as R,q as x,qa as y,r as b,ra as V,w as i,x as P}from"./chunk-WUEKZ7IU.js";function X(o,e){if(o&1&&(s(0,"span")(1,"span"),r(2),E(3,"date"),c(),s(4,"span"),r(5),c()()),o&2){let t=p().$implicit,n=p();a("background","#f8d7da")("width","100%")("display","block"),i(2),d("",H(3,10,t.date,"dd-MM-YYYY")," - "),i(2),a("font-weight","600"),i(),d("",n.getTotalAmountPerDay(t.date),"\u20AC")}}function L(o,e){if(o&1){let t=T();s(0,"span"),w(1,X,6,13,"span",3),m(2,"br"),r(3,"\u0426\u0435\u043D\u0430: "),s(4,"span"),r(5),c(),m(6,"br")(7,"br"),s(8,"div"),r(9," Category: "),s(10,"span",4),h("click",function(){let u=x(t).$implicit,l=p();return b(l.showCategoryDetails(u.category))}),r(11),c()(),r(12),E(13,"date"),m(14,"br")(15,"br"),s(16,"span",4),h("click",function(){let u=x(t).index,l=p();return b(l.onDelete(u))}),r(17,"Delete |"),c(),s(18,"span",4),h("click",function(){let u=x(t).index,l=p();return b(l.onDeleteFromBalance(u))}),r(19," Delete from balance"),c(),m(20,"hr"),c()}if(o&2){let t=e.$implicit,n=p();i(),_("ngIf",t.showDateTitle),i(3),a("color","#ff6f61"),i(),d("",t.amount,"\u20AC"),i(5),a("color","blue"),i(),M(n.getCategoryNameByIdFunc(t.category)),i(),d(" Date: ",H(13,20,t.date,"HH:mm")," "),i(4),a("color","grey")("cursor","pointer"),i(2),a("color","grey")("cursor","pointer"),i(2),a("background","#f8d7da")("height","2px")}}var D=class o{constructor(e){this.router=e}expenses=[];totalAmount=0;temporaryDate=0;totalAmountPerDays=new Map;getCategoryNameByIdFunc=V;ngOnInit(){let e=JSON.parse(localStorage.getItem("expenses")||"[]").map(t=>t.category==="canteen"||t.category==="bar"?C(S({},t),{category:"meal"}):t);localStorage.setItem("expenses",JSON.stringify(e)),this.expenses=JSON.parse(localStorage.getItem("expenses")||"[]").map(t=>{let n=this.isDatePanelVisible(t.date);if(n)this.totalAmountPerDays.set(t.date,t.amount);else{let u=this.totalAmountPerDays.get(this.temporaryDate)||0,l=Math.round((u+t.amount)*100)/100;this.totalAmountPerDays.set(this.temporaryDate,l)}return C(S({},t),{showDateTitle:n})}),this.sumValues()}getTotalAmountPerDay(e){return this.totalAmountPerDays.get(e)||0}onDelete(e){confirm("Delete?")&&(this.updateBalance(e),this.expenses.splice(e,1),localStorage.setItem("expenses",JSON.stringify(this.expenses)),this.sumValues())}updateBalance(e){let t=Number(localStorage.getItem("balance"))||0;if(t){let n=Math.round((t+this.expenses[e].amount)*100)/100;localStorage.setItem("balance",n.toString())}}onDeleteFromBalance(e){confirm("Return to balance?")&&this.updateBalance(e)}onSwipeRight(){this.router.navigate(["/"])}showCategoryDetails(e){this.router.navigate(["/details"],{queryParams:{"category-id":e,"back-url":"/history"}})}isDatePanelVisible(e){return this.temporaryDate===0?(this.temporaryDate=e,!0):new Date(this.temporaryDate).toDateString()===new Date(e).toDateString()?!1:(this.temporaryDate=e,!0)}touchStartX=0;touchStartY=0;touchEndX=0;touchEndY=0;onTouchStart(e){this.touchStartX=e.changedTouches[0].screenX,this.touchStartY=e.changedTouches[0].screenY}onTouchEnd(e){this.touchEndX=e.changedTouches[0].screenX,this.touchEndY=e.changedTouches[0].screenY,this.handleSwipeGesture()}handleSwipeGesture(){let e=this.touchEndX-this.touchStartX,t=this.touchEndY-this.touchStartY;Math.abs(e)>Math.abs(t)&&(e>50?this.onSwipeRight():e<-50&&this.onSwipeLeft())}onSwipeLeft(){this.router.navigate(["/statistics"])}sumValues(){this.totalAmount=this.expenses.reduce((e,t)=>{let n=e+t.amount;return Math.round(n*100)/100},0)}static \u0275fac=function(t){return new(t||o)(P(Y))};static \u0275cmp=I({type:o,selectors:[["app-history"]],hostBindings:function(t,n){t&1&&h("touchstart",function(l){return n.onTouchStart(l)})("touchend",function(l){return n.onTouchEnd(l)})},decls:11,vars:15,consts:[[1,"history-container"],[3,"routerLink"],[4,"ngFor","ngForOf"],[3,"background","width","display",4,"ngIf"],[3,"click"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"span",1),r(2,"< Back"),c(),m(3,"br"),s(4,"div")(5,"span"),r(6,"\u041E\u0431\u0449\u0438\u0439 \u0440\u0430\u0441\u0445\u043E\u0434: "),c(),s(7,"span"),r(8),c()(),m(9,"hr"),w(10,L,21,23,"span",2),c()),t&2&&(i(),a("color","blue")("cursor","pointer"),_("routerLink","/"),i(3),a("margin","10","px"),i(3),a("color","#ff6f61"),i(),d("",n.totalAmount,"\u20AC"),i(),a("background","#f8d7da")("height","2px"),i(),_("ngForOf",n.expenses))},dependencies:[R,k,B,N],styles:[".history-container[_ngcontent-%COMP%]{height:100dvh;overflow-y:scroll}"]})};var j=[{path:"",component:D}],v=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=g({type:o});static \u0275inj=f({imports:[y.forChild(j),y]})};var O=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=g({type:o});static \u0275inj=f({imports:[y,v,A]})};export{O as HistoryModule};
