import{B as C,C as b,D as s,G as r,H as c,I as u,J as M,K as h,L as p,N as a,O as T,P as d,V as S,W as w,a as E,b as P,da as k,ea as B,fa as A,ga as N,k as f,m as H,n as g,oa as Y,pa as R,q as x,qa as y,r as _,ra as V,w as n,x as I}from"./chunk-D2SRSVWV.js";function X(o,t){if(o&1&&(r(0,"span")(1,"span"),a(2),S(3,"date"),c(),r(4,"span"),a(5),c()()),o&2){let e=p().$implicit,i=p();s("background","#f8d7da")("width","100%")("display","block"),n(2),d("",w(3,10,e.date,"dd-MM-YYYY")," - "),n(2),s("font-weight","600"),n(),d("",i.getTotalAmountPerDay(e.date),"\u20AC")}}function L(o,t){if(o&1){let e=M();r(0,"span"),C(1,X,6,13,"span",3),r(2,"div",4),u(3,"br"),a(4,"\u0426\u0435\u043D\u0430: "),r(5,"span"),a(6),c(),u(7,"br")(8,"br"),r(9,"div"),a(10," Category: "),r(11,"span",5),h("click",function(){let l=x(e).$implicit,m=p();return _(m.showCategoryDetails(l.category))}),a(12),c()(),a(13),S(14,"date"),u(15,"br")(16,"br"),r(17,"span",5),h("click",function(){let l=x(e).index,m=p();return _(m.onDelete(l))}),a(18,"Delete |"),c(),r(19,"span",5),h("click",function(){let l=x(e).index,m=p();return _(m.onDeleteFromBalance(l))}),a(20," Delete from balance"),c()(),u(21,"hr"),c()}if(o&2){let e=t.$implicit,i=p();n(),b("ngIf",e.showDateTitle),n(4),s("color","#ff6f61"),n(),d("",e.amount,"\u20AC"),n(5),s("color","blue"),n(),T(i.getCategoryNameByIdFunc(e.category)),n(),d(" Date: ",w(14,20,e.date,"HH:mm")," "),n(4),s("color","grey")("cursor","pointer"),n(2),s("color","grey")("cursor","pointer"),n(2),s("background","#f8d7da")("height","2px")}}var v=class o{constructor(t){this.router=t}expenses=[];totalAmount=0;temporaryDate=0;totalAmountPerDays=new Map;getCategoryNameByIdFunc=V;ngOnInit(){this.expenses=JSON.parse(localStorage.getItem("expenses")||"[]").map(t=>{let e=this.isDatePanelVisible(t.date);if(e)this.totalAmountPerDays.set(t.date,t.amount);else{let i=this.totalAmountPerDays.get(this.temporaryDate)||0,l=Math.round((i+t.amount)*100)/100;this.totalAmountPerDays.set(this.temporaryDate,l)}return P(E({},t),{showDateTitle:e})}),this.sumValues()}getTotalAmountPerDay(t){return this.totalAmountPerDays.get(t)||0}onDelete(t){confirm("Delete?")&&(this.updateBalance(t),this.expenses.splice(t,1),localStorage.setItem("expenses",JSON.stringify(this.expenses)),this.sumValues())}updateBalance(t){let e=Number(localStorage.getItem("balance"))||0;if(e){let i=Math.round((e+this.expenses[t].amount)*100)/100;localStorage.setItem("balance",i.toString())}}onDeleteFromBalance(t){confirm("Return to balance?")&&this.updateBalance(t)}onSwipeRight(){this.router.navigate(["/"])}showCategoryDetails(t){this.router.navigate(["/details"],{queryParams:{"category-id":t,"back-url":"/history"}})}isDatePanelVisible(t){return this.temporaryDate===0?(this.temporaryDate=t,!0):new Date(this.temporaryDate).toDateString()===new Date(t).toDateString()?!1:(this.temporaryDate=t,!0)}touchStartX=0;touchStartY=0;touchEndX=0;touchEndY=0;onTouchStart(t){this.touchStartX=t.changedTouches[0].screenX,this.touchStartY=t.changedTouches[0].screenY}onTouchEnd(t){this.touchEndX=t.changedTouches[0].screenX,this.touchEndY=t.changedTouches[0].screenY,this.handleSwipeGesture()}handleSwipeGesture(){let t=this.touchEndX-this.touchStartX,e=this.touchEndY-this.touchStartY;Math.abs(t)>Math.abs(e)&&(t>50?this.onSwipeRight():t<-50&&this.onSwipeLeft())}onSwipeLeft(){this.router.navigate(["/statistics"])}sumValues(){this.totalAmount=this.expenses.reduce((t,e)=>{let i=t+e.amount;return Math.round(i*100)/100},0)}static \u0275fac=function(e){return new(e||o)(I(Y))};static \u0275cmp=H({type:o,selectors:[["app-history"]],hostBindings:function(e,i){e&1&&h("touchstart",function(m){return i.onTouchStart(m)})("touchend",function(m){return i.onTouchEnd(m)})},decls:11,vars:15,consts:[[1,"history-container"],[3,"routerLink"],[4,"ngFor","ngForOf"],[3,"background","width","display",4,"ngIf"],[1,"history-item"],[3,"click"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"span",1),a(2,"< Back"),c(),u(3,"br"),r(4,"div")(5,"span"),a(6,"\u041E\u0431\u0449\u0438\u0439 \u0440\u0430\u0441\u0445\u043E\u0434: "),c(),r(7,"span"),a(8),c()(),u(9,"hr"),C(10,L,22,23,"span",2),c()),e&2&&(n(),s("color","blue")("cursor","pointer"),b("routerLink","/"),n(3),s("margin","10","px"),n(3),s("color","#ff6f61"),n(),d("",i.totalAmount,"\u20AC"),n(),s("background","#f8d7da")("height","2px"),n(),b("ngForOf",i.expenses))},dependencies:[R,k,B,A],styles:[".history-container[_ngcontent-%COMP%]{height:100dvh;overflow-y:scroll}.history-container[_ngcontent-%COMP%]   .history-item[_ngcontent-%COMP%]{padding-left:10px}"]})};var j=[{path:"",component:v}],D=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=g({type:o});static \u0275inj=f({imports:[y.forChild(j),y]})};var O=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=g({type:o});static \u0275inj=f({imports:[y,D,N]})};export{O as HistoryModule};
