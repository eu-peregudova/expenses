import{B as v,C as b,D as a,G as s,H as c,I as m,J as T,K as d,L as p,N as r,O as M,P as _,Q as B,W as S,X as w,a as E,b as H,ea as k,fa as A,ga as N,ha as Y,k as y,m as P,n as f,pa as R,q as g,qa as V,r as x,ra as h,sa as F,w as i,x as I}from"./chunk-ZW44M6DJ.js";function L(o,t){if(o&1&&(s(0,"span"),r(1),S(2,"date"),c()),o&2){let e=p().$implicit,n=p();a("background","#f8d7da")("width","100%")("display","block"),i(),B("",w(2,8,e.date,"dd-MM-YYYY")," - ",n.getTotalAmountPerDay(e.date),"\u20AC")}}function j(o,t){if(o&1){let e=T();s(0,"span"),v(1,L,3,11,"span",3),m(2,"br"),r(3,"\u0426\u0435\u043D\u0430: "),s(4,"span"),r(5),c(),m(6,"br"),s(7,"div"),r(8,"Category: "),s(9,"span",4),d("click",function(){let u=g(e).$implicit,l=p();return x(l.showCategoryDetails(u.category))}),r(10),c()(),r(11),S(12,"date"),m(13,"br")(14,"br"),s(15,"span",4),d("click",function(){let u=g(e).index,l=p();return x(l.onDelete(u))}),r(16,"Delete |"),c(),s(17,"span",4),d("click",function(){let u=g(e).index,l=p();return x(l.onDeleteFromBalance(u))}),r(18," Delete from balance"),c(),m(19,"hr"),c()}if(o&2){let e=t.$implicit,n=p();i(),b("ngIf",e.showDateTitle),i(3),a("color","#DB2C07"),i(),_("",e.amount,"\u20AC"),i(4),a("color","blue"),i(),M(n.getCategoryNameByIdFunc(e.category)),i(),_(" Date: ",w(12,20,e.date,"HH:mm")," "),i(4),a("color","grey")("cursor","pointer"),i(2),a("color","grey")("cursor","pointer"),i(2),a("background","#f8d7da")("height","2px")}}var D=class o{constructor(t){this.router=t}expenses=[];totalAmount=0;temporaryDate=0;totalAmountPerDays=new Map;getCategoryNameByIdFunc=F;ngOnInit(){this.expenses=JSON.parse(localStorage.getItem("expenses")||"[]").map(t=>{let e=this.isDatePanelVisible(t.date);if(e)this.totalAmountPerDays.set(t.date,t.amount);else{let n=this.totalAmountPerDays.get(this.temporaryDate)||0,u=Math.round((n+t.amount)*100)/100;this.totalAmountPerDays.set(this.temporaryDate,u)}return H(E({},t),{showDateTitle:e})}),this.sumValues()}getTotalAmountPerDay(t){return this.totalAmountPerDays.get(t)||0}onDelete(t){confirm("Delete?")&&(this.updateBalance(t),this.expenses.splice(t,1),localStorage.setItem("expenses",JSON.stringify(this.expenses)),this.sumValues())}updateBalance(t){let e=Number(localStorage.getItem("balance"))||0;if(e){let n=Math.round((e+this.expenses[t].amount)*100)/100;localStorage.setItem("balance",n.toString())}}onDeleteFromBalance(t){confirm("Return to balance?")&&this.updateBalance(t)}onSwipeRight(){this.router.navigate(["/"])}showCategoryDetails(t){this.router.navigate(["/details"],{queryParams:{"category-id":t,"back-url":"/history"}})}isDatePanelVisible(t){return this.temporaryDate===0?(this.temporaryDate=t,!0):new Date(this.temporaryDate).toDateString()===new Date(t).toDateString()?!1:(this.temporaryDate=t,!0)}touchStartX=0;touchStartY=0;touchEndX=0;touchEndY=0;onTouchStart(t){this.touchStartX=t.changedTouches[0].screenX,this.touchStartY=t.changedTouches[0].screenY}onTouchEnd(t){this.touchEndX=t.changedTouches[0].screenX,this.touchEndY=t.changedTouches[0].screenY,this.handleSwipeGesture()}handleSwipeGesture(){let t=this.touchEndX-this.touchStartX,e=this.touchEndY-this.touchStartY;Math.abs(t)>Math.abs(e)&&(t>50?this.onSwipeRight():t<-50&&this.onSwipeLeft())}onSwipeLeft(){this.router.navigate(["/statistics"])}sumValues(){this.totalAmount=this.expenses.reduce((t,e)=>{let n=t+e.amount;return Math.round(n*100)/100},0)}static \u0275fac=function(e){return new(e||o)(I(R))};static \u0275cmp=P({type:o,selectors:[["app-history"]],hostBindings:function(e,n){e&1&&d("touchstart",function(l){return n.onTouchStart(l)})("touchend",function(l){return n.onTouchEnd(l)})},decls:11,vars:15,consts:[[1,"history-container"],[3,"routerLink"],[4,"ngFor","ngForOf"],[3,"background","width","display",4,"ngIf"],[3,"click"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"span",1),r(2,"< Back"),c(),m(3,"br"),s(4,"div")(5,"span"),r(6,"\u041E\u0431\u0449\u0438\u0439 \u0440\u0430\u0441\u0445\u043E\u0434: "),c(),s(7,"span"),r(8),c()(),m(9,"hr"),v(10,j,20,23,"span",2),c()),e&2&&(i(),a("color","blue")("cursor","pointer"),b("routerLink","/"),i(3),a("margin","10","px"),i(3),a("color","#DB2C07"),i(),_("",n.totalAmount,"\u20AC"),i(),a("background","#f8d7da")("height","2px"),i(),b("ngForOf",n.expenses))},dependencies:[V,k,A,N],styles:[".history-container[_ngcontent-%COMP%]{overflow-y:scroll}"]})};var $=[{path:"",component:D}],C=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=f({type:o});static \u0275inj=y({imports:[h.forChild($),h]})};var X=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=f({type:o});static \u0275inj=y({imports:[h,C,Y]})};export{X as HistoryModule};
